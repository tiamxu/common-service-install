# This exemple will provide you every alerts that occured between the sleeping time your configured in your config file.
# Every match will be send as a unique alert to discord. If you got 3 match, the alerter will send 3 alert to your discord.

name: "NginxStatus5xxError"
type: "frequency"
index: ingress-logs-%Y-%m-%d
use_strftime_index: true

# Exemple query
filter:
- query:
    query_string:
      query: "upstream_status : [500 TO 599] AND (NOT domain: cloud-report.youzhanjia.com)"
#filter:
#- range:
#    status:
#      from: 500
#      to: 599

realert:
  minutes: 0
timeframe:
  minutes: 60
num_events: 10

timestamp_field: "timestamp"
timestamp_type: "iso"
query_timezone: ""
use_local_time: true

alert:
- "elastalert_modules.feishu_alert.FeishuAlert"

feishualert_url: "https://open.feishu.cn/open-apis/bot/v2/hook/"

feishualert_botid:
  "68600be3-9fe0-40cb-a81e-0f9b00b77acf"

feishualert_title:
  "ELK Alarm NginxStatus5xxError"

feishualert_skip:
  start: "00:00:00"
  end: "00:01:00"

feishualert_body:
  "
  type: {feishualert_title}\n
  url: {url}\n
  status: {status}\n
  upstream_status: {upstream_status}\n
  request_time: {request_time}\n
  upstream_response_time: {upstream_response_time}\n
  num_hits: {num_hits}
  "

